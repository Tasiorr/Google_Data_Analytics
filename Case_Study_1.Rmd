---
title: "Case_Study_1"
author: "Michal Przybylowicz"
date: "8 01 2022"
output: html_document
---

# PROCESS

# Install required packages
```{r}
library(tidyverse)  #helps wrangle data
library(lubridate)  #helps wrangle date attributes
library(ggplot2)    #helps visualize data
library(dplyr)  
```


# Reading from CSV Files
```{r}
csv_files <- list.files(path = "C:/Users/przyb/Desktop/Case study1/CSV", recursive = TRUE, full.names = TRUE) %>%
  lapply(read_csv) %>%
  bind_rows
```


# Creating a Data Frame
All the csvs files will be concatenated into one dataframe.
```{r}
df <- as.data.frame(csv_files)
```


# Removing Duplicates
```{r}
df_no_dups <- df[!duplicated(df$ride_id),]
print(paste("Removed", nrow(df) - nrow(df_no_dups), "duplicated rows"))
```


# Total time of a bike ride
Represents the total time of a bike ride, in minutes
```{r}
df_no_dups <- df_no_dups %>%
  mutate(ride_time_m = as.numeric(df_no_dups$ended_at - df_no_dups$started_at)/60)
summary(df_no_dups$ride_time_m)
```


# Added new columns: start_day, end_day, moth, year and delate start_lat, start_lng, end_lat
```{r}
df_no_dups <- df_no_dups %>%
  mutate(start_day = weekdays(started_at),
         end_day = paste(strftime(df_no_dups$ended_at, "%u"), "-", strftime(df_no_dups$ended_at, "%a")),
         month = format(as.POSIXct(started_at), "%m"),
         year = year(started_at),
         hour = strftime(df_no_dups$ended_at, "%H"),
         start_lat = NULL,
         start_lng = NULL,
         end_lat = NULL)
```


# Negativ trip duration
  Negative values has to be deleted.
```{r}
df_no_dups %>% 
  filter(ride_time_m < 0) %>% 
  summarize("value"=n()) ##Number of negative values
```
  Remove the negative values
```{r}
df_no_dups <- df_no_dups %>%
  filter(-ride_time_m < 0)
```


# Saving the result as a CSV
```{r}
df_no_dups %>%
  write.csv("case_study_1.csv")
```


# DATA ANALYZE
```{r}
summary(df_no_dups)
```
One thing that immediately catches the attention is ride_time_m. This field has no more negative values but the biggest value is 55944,15 which is almost 39 days. This field will be explored further in the document.


#Casuals vs members
How much of the data is about members and how much is about casuals?
```{r}
df_no_dups %>%
  group_by(member_casual) %>%
  summarise("count" = length(ride_id),
            "%" = length(ride_id) / nrow(df_no_dups) * 100)
```

Plot the chart
```{r}
myplot <- ggplot(df_no_dups, aes(member_casual,  fill=member_casual)) + 
  geom_bar(aes(y = (..count..)/sum(..count..))) +  
  scale_y_continuous(labels=scales::percent) +
  labs(x="Casuals vs Members", title="Case study 01 - Casuals vs Members distribution")

myplot
```


#Month
How much of the data is distributed by month?
```{r}
df_no_dups %>%
    group_by(month) %>%
    summarise(count = length(ride_id),
              '%' = (length(ride_id) / nrow(df_no_dups)) * 100,
              'members_p' = (sum(member_casual == "member") / length(ride_id)) * 100,
              'casual_p' = (sum(member_casual == "casual") / length(ride_id)) * 100,
              'Member x Casual Perc Difer' = members_p - casual_p)
```

```{r}
df_no_dups %>%
  ggplot(aes(month, fill=member_casual)) +
    geom_bar() +
    labs(x="Month", title="Chart 02 - Distribution by month") +
    coord_flip()
```


#Weekday
How much of the data is distributed by weekday?
```{r}
df_no_dups %>%
    group_by(end_day) %>% 
    summarise(count = length(ride_id),
              '%' = (length(ride_id) / nrow(df_no_dups)) * 100,
              'members_p' = (sum(member_casual == "member") / length(ride_id)) * 100,
              'casual_p' = (sum(member_casual == "casual") / length(ride_id)) * 100,
              'Member x Casual Perc Difer' = members_p - casual_p)
```
```{r}
ggplot(df_no_dups, aes(end_day, fill=member_casual)) +
    geom_bar() +
    labs(x="Weekdady", title="Chart 03 - Distribution by weekday") +
    coord_flip()
```


#Hour of the day
```{r}
df_no_dups %>%
    group_by(hour) %>% 
    summarise(count = length(ride_id),
          '%' = (length(ride_id) / nrow(df_no_dups)) * 100,
          'members_p' = (sum(member_casual == "member") / length(ride_id)) * 100,
          'casual_p' = (sum(member_casual == "casual") / length(ride_id)) * 100,
          'member_casual_perc_difer' = members_p - casual_p)
```

```{r}
df_no_dups %>%
    ggplot(aes(hour, fill=member_casual)) +
    labs(x="Hour of the day", title="Chart 04 - Distribution by hour of the day") +
    geom_bar()
```

This chart can be expanded ween seen it divided by day of the week.
```{r}
df_no_dups %>%
    ggplot(aes(hour, fill=member_casual)) +
    geom_bar() +
    labs(x="Hour of the day", title="Chart 05 - Distribution by hour of the day divided by weekday") +
    facet_wrap(~ end_day)
```


#Rideable type
```{r}
df_no_dups %>%
    group_by(rideable_type) %>% 
    summarise(count = length(ride_id),
          '%' = (length(ride_id) / nrow(df_no_dups)) * 100,
          'members_p' = (sum(member_casual == "member") / length(ride_id)) * 100,
          'casual_p' = (sum(member_casual == "casual") / length(ride_id)) * 100,
          'member_casual_perc_difer' = members_p - casual_p)
```

```{r}
ggplot(df_no_dups, aes(rideable_type, fill=member_casual)) +
    labs(x="Rideable type", title="Chart 06 - Distribution of types of bikes") +
    geom_bar() +
    coord_flip()
```


# ride_time_m
```{r}
summary(df_no_dups$ride_time_m)
```
```{r}
ventiles = quantile(df_no_dups$ride_time_m, seq(0, 1, by=0.05))
ventiles
```

```{r}
cyclistic_without_outliners <- df_no_dups %>% 
    filter(ride_time_m > as.numeric(ventiles['5%'])) %>%
    filter(ride_time_m < as.numeric(ventiles['95%']))

print(paste("Removed", nrow(df_no_dups) - nrow(cyclistic_without_outliners), "rows as outliners" ))
```

#ride_time_m multivariable exploration
```{r}
cyclistic_without_outliners %>% 
    group_by(member_casual) %>% 
    summarise(mean = mean(ride_time_m),
              'first_quarter' = as.numeric(quantile(ride_time_m, .25)),
              'median' = median(ride_time_m),
              'third_quarter' = as.numeric(quantile(ride_time_m, .75)),
              'IR' = third_quarter - first_quarter)
```


```{r}
ggplot(cyclistic_without_outliners, aes(x=member_casual, y=ride_time_m, fill=member_casual)) +
    labs(x="Member x Casual", y="Riding time", title="Chart 07 - Distribution of Riding time for Casual x Member") +
    geom_boxplot()
```

#Ploting with weekday
```{r}
ggplot(cyclistic_without_outliners, aes(x=end_day, y=ride_time_m, fill=member_casual)) +
    geom_boxplot() +
    facet_wrap(~ member_casual) +
    labs(x="Weekday", y="Riding time", title="Chart 08 - Distribution of Riding time for day of the week") +
    coord_flip()
```

#rideable_type
```{r}
ggplot(cyclistic_without_outliners, aes(x=rideable_type, y=ride_time_m, fill=member_casual)) +
    geom_boxplot() +
    facet_wrap(~ member_casual) +
    labs(x="Rideable type", y="Riding time", title="Chart 09 - Distribution of Riding time for rideeable type") +
    coord_flip()
```

















# Show the head of the table
```{r}
head(df)
```

# Show the name of the columns
```{r}
colnames(df)
```

# Amount of unique values in columns
```{r}
sapply(df, n_distinct) #Show the number of unique values in columns
```

# Amount of emenets with unique value
```{r}
df %>% group_by(member_casual) %>%
  summarize("amount"=n())
```








